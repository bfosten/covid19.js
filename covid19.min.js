/*! covid19.js v1.1.1 | (c) | Created by Sean McClure - MIT License */
function fetch_all_data(){covid.fetch_corona_data("confirmed",{}),covid.fetch_corona_data("deaths",{}),covid.fetch_corona_data("recovered",{}),covid.call_once_satisfied({condition:"covid.hold_value.corona_dates.length > 0",function:function(){covid.delay_multiple({delay:40,iterations:covid.hold_value.corona_dates.length,function:function(){covid.hold_value.delay_cnt++,covid.fetch_corona_reports(covid.hold_value.corona_dates[covid.hold_value.delay_cnt].trim())}})}})}covid={hold_value:hold_value={},"hold_value.corona_dates":hold_value.corona_dates=[],"hold_value.delay_cnt":hold_value.delay_cnt=-1,"hold_value.date_cnt":hold_value.date_cnt=0,dedupe_array:function(e){return new_arr=e.filter(function(t,o){return e.indexOf(t)==o}),new_arr},remove_from_array:function(e,t){return new_arr=e.filter(function(e){return e!==t}),new_arr},sort_object:function(e){return items=Object.keys(e).map(function(t){return[t,e[t]]}),items.sort(function(e,t){return t[1]-e[1]}),sorted_obj={},Object.keys(items).forEach(function(e,t){Object.keys(items)[t];var o=Object.values(items)[t];use_key=o[0],use_value=o[1],sorted_obj[use_key]=use_value}),sorted_obj},get_everything_after:function(e,t){return new_str=e.split(t).pop(),new_str},call_callback:function(e){},call_once_satisfied:function call_once_satisfied(props){eval(props.condition)?"function"==typeof props.function?covid.call_callback(props.function()):eval(props.function):setTimeout(function(){call_once_satisfied(props)},100)},delay_multiple:function delay_multiple(options){var index=0;function delayed_loop(){setTimeout(function(){"function"==typeof options.function?covid.call_callback(options.function()):eval(options.function),index++,index<options.iterations&&delayed_loop()},options.delay)}delayed_loop()},urls:urls={time_series_confirmed:"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv",time_series_deaths:"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Deaths.csv",time_series_recovered:"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Recovered.csv",daily_reports:"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_daily_reports/XX-XX-XXXX.csv"},clean_first_commas_from_states:function(e){var t=[];return e.split("\n").forEach(function(e){if(""!==e)if(e.split(",")[0].includes('"')){var o=e.replace(","," ");t.push(o)}else t.push(e)}),t},clean_commas_from_countries:function(e){return e.split("Korea, South").join("Korea South").split("Bahamas, The").join("Bahamas").split("Gambia, The").join("Gambia")},convert_fetched_csv_to_json:function(e){var t=covid.clean_commas_from_countries(e),o=covid.clean_first_commas_from_states(t),r=[];return o.forEach(function(e,t){var o={};0===t?header_elems=e.split(","):(e.split(",").forEach(function(e,t){void 0!==header_elems[t]&&(o[header_elems[t].trim()]=e)}),r.push(o))}),r},convert_json_to_line_data:function(e){var t=[];return date_cnt=0,e.forEach(function(e){var o=[];Object.keys(e).forEach(function(t,r){!t.includes("/")||t.includes("Province")||t.includes("State")||t.includes("Country")?(t.includes("Country/Region")&&o.push(e["Country/Region"].split('"').join("").trim()),t.includes("Province")&&o.push(e["Province/State"].split('"').join("").trim())):(date_cnt++,inner_inner={},inner_inner.index=date_cnt,Math.sign(Number(Object.values(e)[r]))<0?inner_inner.value=0:inner_inner.value=Number(Object.values(e)[r]),inner_inner.true_date=t,o.push(inner_inner))}),t.push(o),date_cnt=0}),t},get_all_countries:function(e){var t=[];return covid.fetch_results[e].forEach(function(e,o){t.push(e[1])}),covid.dedupe_array(t)},get_all_country_states:function(e,t){var o=[];return covid.fetch_results[e].forEach(function(e,r){e[1]===t&&o.push(e[0])}),o},check_if_country_has_state:function(e){var t=covid.get_all_country_states("deaths",e);if(0===t.length||""===t[0])var o=!1;else o=!0;return o},find_time_series_with_state:function(e,t,o){var r={};return covid.fetch_results[e].forEach(function(e){if(e[0]===t&&e[1]===o){var n=covid.remove_from_array(e,o);r[e[0]]=covid.remove_from_array(n,t)}if(""===e[0]&&e[1]===o){n=covid.remove_from_array(e,o);r[e[1]]=covid.remove_from_array(n,"")}}),r},find_time_series_with_country:function(e,t){var o={};return covid.fetch_results[e].forEach(function(e){if(e[1]===t){var r=covid.remove_from_array(e,"");o[e[1]]=covid.remove_from_array(r,t)}}),o},get_data_dates:function(e){var t=covid.remove_from_array(covid.get_everything_after(e.split("\n")[0],"Long").split(","),"");hold_value.date_cnt++,1===hold_value.date_cnt&&t.forEach(function(e){var t=e.split("/");if(t[0].length<2)var o="0"+t[0];else o=t[0];if(t[1].length<2)var r="0"+t[1];else r=t[1];var n=t[2].replace("20","2020");covid.hold_value.corona_dates.push(o.trim()+"-"+r.trim()+"-"+n.trim())})},get_available_dates:function(){return covid.hold_value.corona_dates},get_report_by_country_and_state:function(e,t,o){var r={};return covid.fetch_results_reports[e].forEach(function(e){e["Country/Region"]===t&&e["Province/State"]===o&&(r.deaths=e.Deaths,r.confirmed=e.Confirmed,r.recovered=e.Recovered)}),r},get_global_report:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1),o=[];return covid.fetch_results_reports[covid.hold_value.corona_dates[covid.hold_value.corona_dates.length-1].trim()].forEach(function(e){""!==e[t]&&void 0!==e[t]&&o.push(Number(e[t]))}),o.reduce((e,t)=>e+t,0)},order_totals_by_country:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1),o={};return covid.fetch_results_reports[covid.hold_value.corona_dates[covid.hold_value.corona_dates.length-1].trim()].forEach(function(e){""!==e[t]&&void 0!==e[t]&&(Object.keys(o).includes(e["Country/Region"])?o[e["Country/Region"]].push(Number(e[t])):o[e["Country/Region"]]=[Number(e[t])])}),o},order_totals_by_state:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1),o={};return covid.fetch_results_reports[covid.hold_value.corona_dates[covid.hold_value.corona_dates.length-1].trim()].forEach(function(e){""!==e[t]&&void 0!==e[t]&&(Object.keys(o).includes(e["Province/State"])?""===e["Province/State"]?(e["Province/State"]=e["Country/Region"],o[e["Province/State"]].push(Number(e[t]))):o[e["Province/State"]].push(Number(e[t])):""===e["Province/State"]?(e["Province/State"]=e["Country/Region"],o[e["Province/State"]]=[Number(e[t])]):o[e["Province/State"]]=[Number(e[t])])}),o},sort_totals_by_country:function(e){var t=covid.order_totals_by_country(e);return res={},Object.keys(t).forEach(function(e,o){res[e]=Object.values(t)[o].reduce((e,t)=>e+t,0)}),covid.sort_object(res)},sort_totals_by_state:function(e){var t=covid.order_totals_by_state(e);return res={},Object.keys(t).forEach(function(e,o){res[e]=Object.values(t)[o].reduce((e,t)=>e+t,0)}),covid.sort_object(res)},get_longs_and_lats:function(e){var t=[],o=covid.fetch_results_reports[covid.hold_value.corona_dates[covid.hold_value.corona_dates.length-1].trim()],r=[],n=[],c=[];return o.forEach(function(e){r.push(e.Deaths),n.push(e.Confirmed),c.push(e.Recovered)}),o.forEach(function(e,o){var r={};r.state=e["Province/State"],r.country=e["Country/Region"],r.longitude=e.Longitude,r.latitude=e.Latitude,t.push(r)}),t},fetch_corona_data:function(e){if("confirmed"==e)var t=covid.urls.time_series_confirmed;if("deaths"==e)t=covid.urls.time_series_deaths;if("recovered"==e)t=covid.urls.time_series_recovered;fetch(t).then(e=>e.text()).then(t=>{covid.get_data_dates(t);var o=covid.convert_fetched_csv_to_json(t);covid.fetch_results[e]=covid.convert_json_to_line_data(o)})},fetch_corona_reports:function(e){var t=urls.daily_reports.replace("XX-XX-XXXX",e);fetch(t).then(e=>e.text()).then(t=>{covid.fetch_results_reports[e]=covid.convert_fetched_csv_to_json(t)})},get_states_and_countries:function(){var e=[];return covid.fetch_results_reports[covid.hold_value.corona_dates[covid.hold_value.corona_dates.length-1].trim()].forEach(function(t){if(""!==t.Deaths&&void 0!==t.Deaths){var o={};o.country=t["Country/Region"],o.state=t["Province/State"],e.push(o)}}),e},get_country_from_state:function(e){var t="";return covid.get_states_and_countries().forEach(function(o){o.state===e&&(t=o.country),"Korea South"===e&&(t="Korea South")}),t},fetch_results:fetch_results={},fetch_results_reports:fetch_results_reports={}},fetch_all_data(),covid.call_once_satisfied({condition:"Object.keys(covid.fetch_results_reports).length > 0 && Object.keys(covid.fetch_results_reports).length === covid.hold_value.corona_dates.length",function:function(){covid.hold_value.loaded_state=!0,console.log("All data loaded. Everything ready!")}}),covid.hold_value.loaded_state=!1;